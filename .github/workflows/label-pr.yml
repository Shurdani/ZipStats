name: ðŸ·ï¸ Auto-label PRs

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  label:
    name: Add Labels
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Label PR based on files changed
      uses: actions/labeler@v5
      with:
        repo-token: "${{ secrets.GITHUB_TOKEN }}"
        sync-labels: false
        configuration-path: .github/labeler.yml

    - name: Label by title/description keywords
      uses: actions/github-script@v7
      with:
        script: |
          const title = context.payload.pull_request.title.toLowerCase();
          const body = (context.payload.pull_request.body || '').toLowerCase();
          const text = title + ' ' + body;
          
          const labels = [];
          
          if (text.match(/\b(bug|fix|error|issue|problem|corregir|solucionar)\b/)) {
            labels.push('ðŸ› bug');
          } else if (text.match(/\b(feat|feature|new|add|nuev|aÃ±adir)\b/)) {
            labels.push('âœ¨ feature');
          } else if (text.match(/\b(ui|ux|design|visual|theme|interfaz|pantalla)\b/)) {
            labels.push('ðŸŽ¨ ui');
          } else if (text.match(/\b(refactor|clean|restructure|refactorizar)\b/)) {
            labels.push('ðŸ”§ refactor');
          } else if (text.match(/\b(doc|readme|guide|documentation|documentaciÃ³n)\b/)) {
            labels.push('ðŸ“ documentation');
          } else if (text.match(/\b(test|spec|testing|prueba)\b/)) {
            labels.push('ðŸ§ª tests');
          }
          
          if (labels.length > 0) {
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              labels: labels
            });
          }

